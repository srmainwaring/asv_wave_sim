# Linear potential wave-body model

## Overview

We would like to combine the non-linear hydrostatic restoring force model used in asv_wave_sim with a linear potential flow wave-body interaction model.

The initial application is to buoys and other structures that satisfy the requirement that the displacements about an initial condition are expected to be small. However some of the features may be useful for surface vehicles, in particular the wave radiation damping and added mass contributions from the linear model may provide a better mechanism for damping, particularly for larger / more massive vessels than the current model.

## Approach

The linear wave-body model resolves the interaction into a number of different forces and the way these are incorporated in the simulation differs depending on the type of waves.

### Forces

- Linear hydrostatic buoyancy
- Linear hydrostatic restoring forces
- Wave radiation damping
- Wave radiation added mass
- Wave excitation

### Waves models

- No waves (decay tests)
- Regular waves, single frequency
- Regular waves, multi-frequency
- Random waves, multi-frequency (FFT methods)

## Additional dependencies

### HDF5 reader

The plugin can load BEM data generated by WEC-Sim from hdf5 files. We use
[HighFive](https://github.com/BlueBrain/HighFive) to read the data, which
introduces an additional dependency. The easiest way to satsify this is to
clone [HighFive](https://github.com/BlueBrain/HighFive) into the project
workspace:

```
cd ./gz_waves_ws/src
git clone https://github.com/BlueBrain/HighFive.git
```

Because we use [Eigen](https://eigen.tuxfamily.org/index.php?title=Main_Page) 
to store and access the coefficients, the build command must be modified 
slightly:

```zsh
colcon build --symlink-install --merge-install --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_TESTING=ON -DCMAKE_CXX_STANDARD=17 -DCMAKE_MACOSX_RPATH=FALSE -DCMAKE_INSTALL_NAME_DIR=$(pwd)/install/lib -DHIGHFIVE_USE_EIGEN=ON --packages-select  gz-waves1
```

where the flag `DHIGHFIVE_USE_EIGEN` allows the hdf5 datasets to be read into
Eigen objects directly.

### ROS2 nodes

There is an extra project `gz_waves_bridge` that contains a Node and
launch file for debugging and analysing the forces and pose of a body
using the plugin. This project depends on ROS2 Humble, Gazebo Garden
and the additional packages:

- `gz-sim7`
- `ros_gz_bridge`
- `ros_gz_gazebo`

Run the ROS2 nodes for the ellipsoid example using:

```zsh
ros2 launch gz_waves_bridge ellipsoid_buoy.launch.py
```



## WEC-Sim Review

WEC-Sim will be used to benchmark our calculations. The WEC-Sim Simulink
model has a number of variant subsystems that implement alternative
modelling approaches:

Figure. WEC-Sim simulink model overview.
```
Rigid Body
├── Hydrodynamic Body
│   ├── Hydrostatic Restoring Force Calculation
│   │   └── Linear and Nonlinear Restoring Force Variant Subsystem
│   │       │── Linear Hydrostatic Restoring Force
│   │       │   └── Net Buoyancy Force
│   │       └── Nonlinear Hydrostatic Restoring Force
│   │
│   ├── Wave Diffraction and Excitation Force Calculation
│   │   ├── Linear Wave Excitation Force Variant Subsystem
│   │   │   ├── Irregular Wave Excitation Force
│   │   │   ├── Irregular Wave Nonlinear Yaw
│   │   │   ├── No Wave Excitation Force
│   │   │   ├── Regular Wave Excitation Force
│   │   │   ├── Regular Wave Nonlinear Yaw
│   │   │   └── User Defined Wave Excitation Force
│   │   └── Nonlinear FK Force Variant Subsystem
│   │       ├── No Nonlinear Froude Krylov Force
│   │       └── With Nonlinear Froude Krylov Force
│   │
│   ├── Wave Radiation Force Calculation
│   │   └── SI CI and Constant-Damping Variant Subsystem
│   │       ├── Constant Coefficients
│   │       ├── Convolution Integral Calculation
│   │       └── State-Space Calculation
│   │
│   ├── Morrison Element and Viscous Damping Force Calculation
│   ├── Additional Linear Damping Force Calculation
│   ├── Yaw Force Transforms
│   └── Yaw Kinematic Transforms
│
├── Non-Hydro Body
└── Drag Body
```

Figure. WEC-Sim data model.

```bash
workspace
├── body
│   ├── centerBuoyancy [3]
│   ├── centerGravity [3]
│   ├── dof
│   ├── excitationIRF []
│   ├── geometryFile
│   ├── h5File
│   ├── hydroStiffness [6, 6]
│   ├── inertia [3]
│   ├── initial 
│   │   ├── displacement [3] 
│   │   ├── axis [3]
│   │   └── angle 
│   ├── largeXYDisplacement
│   ├── linearDamping [6, 6]
│   ├── mass
│   ├── meanDrift
│   ├── morrisonElement
│   ├── name
│   ├── nonHydro
│   ├── nonLinearHydro
│   ├── quadDrag
│   ├── paraView
│   ├── viz
│   ├── volume
│   ├── yaw
│   ├── dofStart
│   ├── dofEnd
│   ├── hydroData
│   │   ├── simulation_parameters 
│   │   │   ├── scaled
│   │   │   ├── direction
│   │   │   ├── waterDepth
│   │   │   ├── w [1, 101]
│   │   │   └── T [1, 101]
│   │   ├── properties
│   │   │   ├── name
│   │   │   ├── number
│   │   │   ├── centerGravity [3]
│   │   │   ├── centerBuoyancy [3]
│   │   │   ├── volume
│   │   │   ├── dof
│   │   │   ├── dofStart
│   │   │   └── dofEnd
│   │   └── hydro_coeffs
│   │       ├── linear_restoring_stiffness [6, 6]
│   │       ├── excitation
│   │       │   ├── re [6, 1, 101]
│   │       │   ├── im [6, 1, 101]
│   │       │   ├── fk_re [6, 1, 101]
│   │       │   ├── fk_im [6, 1, 101]
│   │       │   ├── sc_re [6, 1, 101]
│   │       │   ├── sc_im [6, 1, 101]
│   │       │   └── impulse_repsonse_fun
│   │       │       ├── f [6, 1, 1001]
│   │       │       └── t [1001, 1]
│   │       ├── added_mass
│   │       │   ├── all [6, 6, 101]
│   │       │   └── inf_freq [6, 6]
│   │       ├── radiation_damping
│   │       │   ├── all [6, 6, 101]
│   │       │   ├── impulse_repsonse_fun
│   │       │   │   ├── K [6, 6, 1001]
│   │       │   │   └── t [1001, 1]
│   │       │   └── state_space
│   │       │       ├── it [6, 6]
│   │       │       ├── A
│   │       │       ├── B
│   │       │       ├── C
│   │       │       └── D
│   │       └── mean_drift [6, 1, 101]
│   ├── b2bDOF
│   ├── hydroForce # constant force coeffs used in the calc
│   │   ├── linearHydroRestCoeff [6, 6]
│   │   ├── quadDrag [6, 6]
│   │   ├── linearDamping [6, 6]
│   │   ├── fExt
│   │   │   ├── re [6]
│   │   │   └── im [6]
│   │   ├── fkExt
│   │   │   ├── re [6]
│   │   │   └── im [6]
│   │   ├── fExtFK
│   │   │   ├── re [6]
│   │   │   └── im [6]
│   │   ├── fExtSc
│   │   │   ├── re [6]
│   │   │   └── im [6]
│   │   ├── fAddedMass [6, 6]
│   │   ├── fDamping [6, 6]
│   │   ├── totDOF [6, 6]
│   │   └── storage
│   │       ├── mass
│   │       ├── inertia [3]
│   │       └── hydroForce_AddedMass [6, 6]
│   ├── massCalcMethod
│   ├── number
│   ├── total
│   └── geometry
├── constraint
├── hydro # raw data loaded from the h5 file
│   ├── code
│   ├── file
│   ├── body
│   ├── Nb
│   ├── dof
│   ├── cg [3]
│   ├── cb [3]
│   ├── Vo
│   ├── rho
│   ├── g
│   ├── h
│   ├── Nf
│   ├── Nh
│   ├── w [101, 1]
│   ├── T [101, 1]
│   ├── theta
│   ├── Khs [6, 6]
│   ├── A [6, 6, 101]
│   ├── B [6, 6, 101]
│   ├── fk_re [6, 1, 101]
│   ├── fk_im [6, 1, 101]
│   ├── fk_ma [6, 1, 101]
│   ├── fk_ph [6, 1, 101]
│   ├── sc_re [6, 1, 101]
│   ├── sc_im [6, 1, 101]
│   ├── sc_ma [6, 1, 101]
│   ├── sc_ph [6, 1, 101]
│   ├── ex_re [6, 1, 101]
│   ├── ex_im [6, 1, 101]
│   ├── ex_ma [6, 1, 101]
│   ├── ex_ph [6, 1, 101]
│   ├── Ainf [6, 6]
│   ├── ra_K [6, 6, 1001]
│   ├── ra_t [1, 1001]
│   ├── ra_w [1, 1001]
│   ├── ss_A
│   ├── ss_B
│   ├── ss_C
│   ├── ss_D
│   ├── ss_K
│   ├── ss_conv
│   ├── ss_R2
│   ├── ss_O
│   ├── ex_K [6, 1, 1001]
│   ├── ex_t [1, 1001]
│   └── ex_w [1, 1001]
├── output
├── outputFile
├── simu
│   ├── ...
│   ├── gravity
│   ├── ...
│   ├── rampTime
│   ├── ...
│   ├── rho
│   └── ...
└── waves
    ├── bem
    │   ├── option
    │   ├── count []
    │   ├── frequency [1, 101]
    │   └── range [1, 101]
    ├── current
    ├── direction
    ├── ...
    ├── height
    ├── ...
    ├── period
    ├── phaseSeed
    ├── ...
    ├── waterDepth
    ├── spread
    ├── amplitude
    ├── deepWater
    ├── dOmega
    ├── omega
    ├── phase
    ├── ...
    ├── type
    ├── ...
    └── waveNumber
```

## Questions

### Hydrostatics

  1. The sign of the buoyancy torque contribution,
     called `F_rotational_buoyancy` in the Simulink model, has the
     opposite sign to what I'd expect?
  2. The vector `(CoB - CoM)` is held constant in the hydrostatics
     calculations (see `F_rotational_buoyancy` in the `Net Buoyancy Force`
     sub-system block). Required for consistency of the linear model...?
     Need to carefully document the assumptions about what is held constant for
     each contributing force based. 


## References

- Bretl, J. G., 2009. “A time domain model for wave induced motions coupled to energy extraction.”. PhD thesis, Uni- versity of Michigan. https://deepblue.lib.umich.edu/handle/2027.42/62195, retrieved 2022-10-03

- Cummins, W.E. The Impulse Response Function and Ship Motions; AD0288277; DTIC: Washington, DC, USA, 1962; pp. 101–109. https://dome.mit.edu/handle/1721.3/49049, retrieved 2022-10-02

- Nielsen, K.; Wendt, F.; Yu, Y.; Ruehl, K.; Touzon, I.; Nam, B.; Kim, J.; Kim, K.; Crowley, S.; Sheng, W.; et al. OES
Task 10 WEC heaving sphere performance modelling verification. In Proceedings of the 3rd International
Conference on Renewable Energies Offshore (RENEW 2018), Lisbon, Portugal, 8–10 October 2018., https://tethys-engineering.pnnl.gov/sites/default/files/publications/Nielsenetal2018.pdf, retrieved 2022-10-02

- Fabian Wendt et al, Ocean Energy Systems Wave Energy Modelling Task: Modelling, Verification and Validation of Wave Energy Converters, J. Mar. Sci. Eng. 2019, 7, 379; doi:10.3390/jmse7110379. https://www.mdpi.com/2077-1312/7/11/379, retrieved 2022-10-02

- Gilloteaux, J.-C., 2007. Mouvements de grande amplitude d'un corps flottant en fluide parfait. application à la récupération de l'énergie des vagues (Ph.D. thesis). Ecole Centrale de Nantes-ECN. https://tel.archives-ouvertes.fr/tel-00521689/document, retrieved 2022-10-02

- Gilloteaux, J.C.; Ducrozet, G.; Babarit, A.; Clément, A. Non-linear model to simulate large amplitude motions: Application to wave energy conversion. In Proceedings of the 22nd International Workshop on Water Waves and Floating Bodies, Plitvice Lakes, Croatia, 15–18 April 2007. [iwwwfb22_25.pdf](https://www.researchgate.net/publication/258834150_Non-Linear_model_to_simulate_large_amplitude_motions_application_to_wave_energy_conversion/link/02e7e5290f36d390eb000000/download), retrieved 2022-10-02

- Giorgi, G., Penalba, M., Ringwood, J.V., 2016a. Nonlinear hydrodynamic force relevance for different wave energy converter types. In: Proceedings of the 3rd Asian Wave and Tidal Energy Conference. pp. 154–162. https://coer.maynoothuniversity.ie/wp-content/uploads/2018/01/GIORGI-Comparing-nonlinear-hydrodynamic-forces-in-heaving-point-absorbers-and-oscillating-wave-surge-converters-2017.pdf, retrieved 2022-10-02

- Giorgi, G., Ringwood, J.V., 2016b. Computationally efficient nonlinear froude-krylov force calculations for heaving axisymmetric wave energy point absorbers. J. Ocean Eng. Mar. Energy, 1–13. https://ee.maynoothuniversity.ie/jringwood/Respubs/J268GGFK.pdf, retrieved 2022-10-02

- Giorgi, G., Penalba, M., Ringwood, J.V., 2016b. Nonlinear hydrodynamic models for heaving buoy wave energy converters. In: Proceedings of the 3rd Asian Wave and Tidal Energy Conference, pp. 144–153. https://mural.maynoothuniversity.ie/9418/1/JR-Nonlinear-2016.pdf, retrieved 2022-10-02

- Giorgi, G., Ringwood, J.V., 2017b. Comparing nonlinear hydrodynamic forces in heaving point absorbers and oscillating wave surge converters. J. Ocean Eng. Mar. Energy, Submitted for publication.
ICHEC, Irish Centre for High-End Computing (ICHEC), 2016.URL 〈https://www.ichec. ie/. https://mural.maynoothuniversity.ie/12445/1/JR-Comparing-2018.pdf, retrieved 2022-10-02

- Giuseppe Giorgi et al, Nonlinear hydrodynamic modelling of
wave energy converters under controlled conditions, https://core.ac.uk/download/pdf/297030023.pdf, retrieved 2022-10-02

- Giorgi, G.; Ringwood, J.V. Nonlinear Froude-Krylov and viscous drag representations for wave energy converters in the computation/fidelity continuum. Ocean Eng. 2017, 141, 164–175. https://mural.maynoothuniversity.ie/11773/1/Ringwood_Nonlinear_2017.pdf, retrieved 2022-10-02

- Guerinel, M., Alves, M., and Sarmento, A., 2011. “Nonlin- ear modelling of the dynamics of a free floating body”. In EWTEC, Southampton. https://www.researchgate.net/publication/294580110_Nonlinear_Modelling_of_the_Dynamics_of_a_Free_Floating_Body, retrieved 2022-10-03

- A. Merigaud, J. Gilloteaux, and J. Ringwood, “A nonlinear extension for linear boundary element method in wave energy device modelling,” in In Proceedings of the 31st Intl. Conf. on Ocean, Offshore and Artic Engineering (OMAE), Rio de Janeiro, 2012, pp. 615–621. https://www.researchgate.net/publication/267606842_A_Nonlinear_Extension_for_Linear_Boundary_Element_Methods_in_Wave_Energy_Device_Modelling, retrieved 2022-10-03

- Penalba, M.; Ringwood, J. A review of wave-to-wire models for wave energy converters. Energies 2016, 9, 506. https://www.mdpi.com/1996-1073/9/7/506, retrieved 2022-10-02

- M Penalba Retes, A Mérigaud, JC Gilloteaux. Nonlinear Froude-Krylov force modelling for two heaving wave energy point absorbers, Proceedings of the 11th European Wave and Tidal …, 2015, https://mural.maynoothuniversity.ie/6669/1/JR_nonlinear%20Froude.pdf, retrieved 2022-10-03

- M Penalba, A Mérigaud, JC Gilloteaux, JV Ringwood. Influence of nonlinear Froude–Krylov forces on the performance of two wave energy points absorbers, Journal of Ocean Engineering and Marine Energy, 2017. https://mural.maynoothuniversity.ie/11775/1/Ringwood_Influence_2017.pdf, retrieved 2022-10-03

- Wendt, F.; Yu, Y.H.; Nielsen, K.; Ruehl, K.; Bunnik, T.; Touzon, I.; Nam, B.; Kim, J.; Kim, K.H.; Janson, C.; et al. International Energy Agency Ocean Energy Systems Task 10 Wave Energy Converter Modeling Verification
and Validation. In Proceedings of the 12th European Wave and Tidal Energy Conference, Cork, Ireland, 27 August–1 September 2017. ,https://www.nrel.gov/docs/fy18osti/68465.pdf, retrieved 2022-10-02

- Andrew Hamilton, François Cazenave, Dominic Forbush, Ryan G. Coe2, Giorgio Bacelli. The MBARI-WEC: a power source for ocean sensing, Journal of Ocean Engineering and Marine Energy (2021) 7:189–200 https://doi.org/10.1007/s40722-021-00197-9. https://link.springer.com/content/pdf/10.1007/s40722-021-00197-9.pdf, retrieved 2022-10-05

